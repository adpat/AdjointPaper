
\section{Numerical results for model predictive control simulations\label{sec:Numerical-results-for}}

To demonstrate the effectiveness of using the adjoint ramp metering
method to compute gradients, we implemented the algorithm in MATLAB.
The algorithm can then be used as a gradient computation subroutine
inside any descent-method optimization solver that takes advantage
of first-order gradient information. Our implementation makes use
of the open-source \emph{IpOpt} solver~\cite{Andreas2005}. To serve
as comparisons, three other methods were implemented:
\begin{enumerate}
\item No control: the metering rate is set to 1 on all onramps at all times.
\item Alinea~\cite{Papageorgiou1991}: a popular, feedback-based ramp metering
algorithm. Alinea is computationally efficient and decentralized,
making it a popular choice for large networks, but does not take estimated
boundary flow data as input. Since Alinea has a number of tuning parameters,
we perform a \emph{modified} grid-search technique over the different
parameters that scales linearly with the number of onramps, and select
the best-performing parameters. A \emph{full} grid-search approach
scales exponentially with the number of onramps, rendering it infeasible
for moderate-size freeway networks.
\item Descent method without gradient information: in the absence of gradient
information, the descent-method solver will estimate the gradient
by perturbing control parameters and recomputing the objective function.
\end{enumerate}
The descent method proved to be infeasible for even small, synthetic
networks. Running ramp metering on even a network of 4 links over
6 time-steps for only 5 gradient steps took well over 4 minutes. Already,
the method cannot be used in real-time for freeway networks. The comparison
of running times with and without gradient computations is given in
Figure~\ref{fig:Running-time-of}. We do not consider the method
without gradient computations in further results, due to the impractically
large running times, which only becomes worse as the problem scales
to larger networks and time horizons.
\begin{figure}
\begin{centering}
\includegraphics[width=0.65\columnwidth]{images/itergrad}
\par\end{centering}

\caption{Running time of metering algorithm with and without gradient computations.
Network consists of 4 links and 6 time-steps with synthetic boundary
flux data. The method using gradient computations via the adjoint
method converged well before the first step was completed with the
method that used perturbations to compute the gradient.\label{fig:Running-time-of}}
\end{figure}



\subsection{Network\label{sub:Network}}

As input into the optimization problem, we constructed a model of
a \input{fwLength} stretch of the I15 South freeway in San Diego,
California between San Marcos and Mira Mesa.The network has $\nlinks=$
\input{fwNLinks} links, $\ncontrols=$\input{fwNRamps} onramps,
with boundary data specified for $\ntime=$ \input{fwNTime} time-steps,
for a time horizon of \input{fwTimeHorizon} given $\Delta t=$ \input{fwdt}.
The network is shown in Figure~\ref{fig:Model-of-section}.
\begin{figure}
\begin{centering}
\includegraphics[width=0.7\columnwidth]{images/map}
\par\end{centering}

\caption{Model of section of I15 South in San Diego, California. The freeway
section spanning~19.4 miles was split into~125 links with 9 onramps.\label{fig:Model-of-section}}
\end{figure}


Link length data was obtained using the Scenario Editor software developed
as part of the Connected Corridors project, a collaboration between
UC Berkeley and PATH research institute in Berkeley, California.
Fundamental diagram parameters, split ratios, and boundary data were
also obtained using calibration techniques developed by Connected
Corridors. Densities resulting in free-flow speeds were chosen as
initial conditions on the mainline and onramps. The data used in calibration
was taken from PeMS sensor data during a morning rush hour period,
scaled to generate congested conditions. The input data was chosen
to demonstrate the effectiveness of the adjoint ramp metering method
in a real-world setting. A profile of the mainline and onramps during
a forward simulation of the network is shown in Figure~\ref{fig:Density-and-queue}
under the described boundary conditions.
\begin{figure}
\subfloat[Density profile. The units are the ratio of a link's vehicle density
to a link's critical density. Values less than 1 represent free flow,
while values greater than 1 represent congestion.\label{fig:Density-profile.}]{\includegraphics[width=0.45\columnwidth]{images/ncdensity}

}\hfill{}\subfloat[Onramp queue profile in units of vehicles. The onramps are only present
at certain junctions, thus why the nonzero queue lengths are sparse
in this diagram.\label{fig:Density-profile.-2}]{\includegraphics[width=0.45\columnwidth]{images/ncqueue}

}

\caption{Density and queue profile of no-control freeway simulation. In the
first 80 minutes, congestion pockets form on the freeway and queues
form on the onramps, then eventually clear out before 120 minutes.\label{fig:Density-and-queue}}
\end{figure}



\subsection{Finite-horizon optimal control\label{sub:Finite-horizon-optimal-control}}


\paragraph{Experimental setup}

The adjoint ramp metering algorithm is compared to the reactive Alinea
scheme, where we assume perfect boundary conditions and initial conditions
are available. The actual cost used to compare the performances of
the different methods is \emph{delay}, or the total travel time minus
the free-flow total travel time. The free-flow total travel time is
computed by assuming the critical density is infinite for all links,
thus no backwards moving congestion results from high density. The
delay gives an indication of how much improvement is possible, given
that total travel time cannot be zero at optimum.


\paragraph{Results}

\begin{figure}
\subfloat[Density difference profile in units of vehicles per mile.\label{fig:long-sim-density}]{\includegraphics[width=0.45\columnwidth]{images/densdiff}

}\hfill{}\subfloat[Queue difference profile in units of vehicles.\label{fig:long-sim-queue}]{\includegraphics[width=0.45\columnwidth]{images/queuediff}

}

\caption{Profile differences for mainline densities and onramp queues. Evidenced
by the mainly negative differences in the mainline densities and the
mainly positive differences in the onramp queue lengths, the adjoint
ramp metering algorithm effectively limits onramp flows in order to
reduce mainly congestion.\label{fig:long-sim}}
\end{figure}


Figure~\ref{fig:long-sim} shows a difference profile between the
no control simulation and the simulation applying the ramp metering
policy generated from the adjoint method. Negative differences in
Figures~\ref{fig:long-sim-density} and~\ref{fig:long-sim-queue}
indicate where the adjoint method resulted in fewer vehicles for the
specific link and time-step. The adjoint method was successful in
intelligently deciding which ramps should be metered in order to improve
throughput for the mainline.
\begin{figure}
\begin{centering}
\includegraphics[width=0.65\columnwidth]{images/longsim}
\par\end{centering}

\caption{Performance versus simulation time for freeway network. The results
indicate that the algorithm can run with performance better than Alinea
if given an update time around 15 minutes.}
\end{figure}


Running time analysis shows that the adjoint method can produce beneficial
results running in real time. After just a few gradient steps, the
adjoint method outperforms the Alinea method. Given that the time
horizon of two hours is longer than the period of time one can expect
reasonable estimates of boundary conditions, more practical simulations
with shorter time horizons should permit more gradient steps in a
real-time setting.

While the queue length contains a considerable number of cars in some
onramps for the adjoint method, this problem can be accounted for
by introducing barrier terms into the cost function that limit the
maximum queue length. The Alinea method tested for the I15 network
had no prescribed maximum queue lengths as well, but was not able
to produce significant improvements, while the adjoint method was
more successful in optimizing the road network under the set of constraints.


\subsection{Model predictive control\label{sub:Model-predictive-control}}

To study the performance of the algorithm under noisy input data,
we embed both our adjoint ramp metering algorithm and the Alinea algorithm
inside of a \emph{Model predictive control }(MPC) loop.


\paragraph{Experimental setup}

The MPC loop begins at a time $t$ by estimating the initial conditions
of the traffic on the freeway network and the predicted boundary fluxes
over a certain time horizon $T_{h}$. These values are noisy, as exact
estimation of these parameters is not possible on real freeway networks.
The estimated conditions are then passed to the ramp metering algorithm
to compute an optimal control policy over the $T_{h}$ time period.
The system is then forward simulated over an update period of $T_{u}\le T_{h}$,
using the exact initial conditions and boundary conditions, as opposed
to the noisy data used to compute control parameters. The state of
the system and boundary conditions at $t+T_{u}$ are then estimated
(with noise) and the process is repeated.

A non-negative\emph{ noise factor} is used to study how the adjoint
method and Alinea perform as the quality of estimated data decreases.
The noise factor can be summarized as follows:

\[
\bar{\discrete{}{}}=\discrete{}{}*(1+noise\_factor*R)
\]


where $R$ is a uniformly distributed random variable with mean $0$
and domain $\left[-0.5,0.5\right]$. The noise factor was applied
to both initial and boundary conditions.

Two different experiments were conducted:
\begin{enumerate}
\item \textbf{Real-time I15 South}: MPC is run for the I15 South network
with $T_{h}=27$ minutes and $T_{u}=14$ minutes. A noise factor of
2\% was chosen for the initial and boundary conditions. The number
of iterations was chosen in order to ensure that each MPC iteration
finished in the pre-determined update time $T_{u}$.
\item \textbf{Noise Robustness}: MPC is for over a synthetic network with
length 5 miles and boundary conditions over 50 minutes. The experiments
are run over a profile of noise factors between 1\% and 200\%.
\end{enumerate}

\paragraph{Results}


\subparagraph{Real-time I15 South}

The results are summarized in Figure~\ref{fig:MPC-performance-on}.
The adjoint method applied once to the entire horizon with perfect
boundary and initial condition information serves as a baseline performance
for the other simulations, which had noisy input data and limited
knowledge of predicted boundary conditions. The adjoint method still
performs well under the more realistic conditions of the MPC loop
with noise, resulting in 75\% delay as compared to the no control
scenario as compared to the 71\% delay achieved by the perfect-knowledge
adjoint control. Alinea performed worse than adjoint method, only
achieving a 95\% delay as compared to no control. The results indicate
that under a realistic assumption of a 2\% noise factor in the sensor
information, the ability to consider boundary conditions in producing
ramp metering policies as an improvement upon strictly reactive policies,
such as Alinea.

\begin{figure}
\subfloat[MPC performance on I15 South network.\label{fig:MPC-performance-on}]{\includegraphics[width=0.45\columnwidth]{images/longmpc}

}\hfill{}\subfloat[MPC performance with increasing sensor noise.\label{fig:Ramp-metering-performance-1}]{\includegraphics[width=0.45\columnwidth]{images/noiseplot}

}
\end{figure}



\subparagraph{Noise Robustness}

Simulation results on the synthetic network with varying levels of
noise are shown in Figure~\ref{fig:Ramp-metering-performance-1}.
The adjoint method is able to outperform the Alinea method when the
noise level is less than 80\%, a reasonable assumption for data provided
by well-maintained loop detectors. As the initial and boundary condition
data deteriorates, the adjoint method becomes useless. Since Alinea
does not rely on boundary data, it is able to produce improvements,
even with severely noisy data. The results indicate that the adjoint
method will outperform Alinea under reasonable noise levels in the
sensor data.
