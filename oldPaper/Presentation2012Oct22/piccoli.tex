\section{Piccoli Model}
\subsection{Classical Riemann Problem}
%\subsubsection{Classical Riemann Problem}
\begin{frame}
	\frametitle{Classical Riemann Problem}
A classical Riemann Problem is a PDE with a particular choice of initial data:
\begin{equation}
        \label{eq:RP}
	\begin{cases}
		\del_t \rho + \del_x f(\rho) =0, \\
		\rho(0,x) = \left\{
		\begin{array}{ll}
			\rho_L &\hbox{if}~x<0, \\
			\rho_R &\hbox{if}~x>0.
		\end{array}
		\right. 
	\end{cases}
\end{equation}
\begin{columns}
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
\input{RPinitial}
\caption{Initial data for the $\Riem$.}
\label{fig:initialData}
\end{figure}
	\pause
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
\input{shock}
\caption{Solution of the $\Riem$.}
\label{fig:RPsolution}
\end{figure}
	\end{columns}
\end{frame}

\subsection{2x2 Junction model}
%\subsubsection{LWR on a 2x2 junction}
\begin{frame}
	\frametitle{LWR on a 2x2 junction\footnote[frame]{M.Garavello and B.Piccoli, \textit{Traffic Flows on Networks:Conservation Laws Model}. \\AIMS Series on Applied Mathematics. American Institute of Mathematical Sciences,\\2006}}
	\begin{figure}[ht]
\centering
\input{Junction}
\caption{Generic 2x2 junction.}
\label{fig:junction}
\end{figure}
	
\begin{itemize}
	\item $I_i=[a_i,b_i]$ for $i=1,2$ and $I_j=[a_j,b_j]$ for $j=3,4$.
	\item $\del_t \rho +\del_x f(\rho)=0$ holds on each $I_i$ and $I_j$.
	\item Flux function strictly concave.
	\item $f(0)=f(1)=0$.
	\item Flux function has a unique maximum at $\rho^{cr} \in ]0,1[$.
\end{itemize}
\end{frame}

%\subsubsection{Junction assumptions}
\begin{frame}
	\frametitle{Junction assumptions}
\begin{enumerate} 
	\item A traffic distribution matrix is given \[
 A = \begin{bmatrix}
       \alpha_{3,1} & \alpha_{3,2}            \\[0.3em]
       \alpha_{4,1} & \alpha_{4,2}
     \end{bmatrix}
\]
\textcolor{red}{Remark:} $\alpha_{j,1}\neq\alpha_{j,2} \quad \forall j\in\left\lbrace3,4\right\rbrace.$
	\item Rankine-Hugoniot condition is satisfied, i.e., $$\sum_{i=1}^2 f_i(\rho(t,b_i-))=\sum_{j=3}^4 f_j(\rho(t,a_j+)).$$
	\item \label{item:cons_flux} Each $f_j(\rho(t,a_j+))=\sum\limits_{i=1}^2 \alpha_{j,i}f_i(\rho(t, b_i-))$ for every $j=3,4 .$
	\item $\sum\limits_{i=1}^2 f_i(\rho(t,b_i-))$	is maximum subject to \ref{item:cons_flux}. 
	
\end{enumerate}
	
\end{frame}

%\subsubsection{Riemann Problem at the Junction}
\begin{frame}
	\frametitle{Riemann Problem at the Junction}
\begin{itemize}
	\item Define initial data $\rho_{i,0},\rho_{j,0} \in ]0,1[$ for every $i=1,2$ and $j=3,4$.
	\vspace*{5mm}
	\item The Riemann Problem at J is the LWR where the initial conditions are given by $\rho_{i,0}(x)\equiv \rho_{i,0} $ in $I_i$ for every $i=1,2$ and $\rho_{j,0}(x)\equiv \rho_{j,0} $ in $I_j$ for every $j=3,4$.
	\vspace*{5mm}
	\item The Riemann Solver $\RS$ is the right continuous map $(t,x)\rightarrow \RS (\rho_l , \rho_r)(\frac{x}{t})$ that is the standard weak entropy solution to \eqref{eq:RP}.
\end{itemize}
\end{frame}	


%\subsubsection{Riemann Solver}
\begin{frame}[fragile]
	\frametitle{Riemann Solver}
To find a solution of the problem we will take the following steps.
\begin{itemize}
	\item Define $\gamma_1=f_1(\rho(t,b_1-))$ and $\gamma_2=f_2(\rho(t,b_2-))$.
	\item<1-> Define the space $(\gamma_1 ,\gamma_2).$
	\only<1-1> {\begin{figure}[ht]
\centering
\input{space}
%\caption{Solution of the Riemann Problem.}
\label{fig:spaceSet}
\end{figure}} 	
	\item<2-> Define $\gamma_i^{\max}(\rho_{i,0})$ and $\gamma_j^{\max}(\rho_{j,0})$ for each $i=1,2$ and $j=3,4$ as the maximum flux that can be obtained by a simple wave solution on each road.
	\only<2-2>{\vspace*{35mm}}
	\item<3-> Define the sets $\Omega_i=[0,\gamma_i^{\max}(\rho_{i,0})] \quad i=1,2.$
	\only<3-3>{ \begin{figure}[ht]
\centering
\input{set}
%\caption{Solution of the Riemann Problem.}
\label{fig:Set}
\end{figure}}
\end{itemize}	
\end{frame}	


%\subsubsection{Riemann Solver II}
\begin{frame}[fragile]
	\frametitle{Riemann Solver II}
	\begin{itemize}
	\item<1-> Define the set $\Omega_j=[0,\gamma_j^{\max}(\rho_{j,0})] \quad j=3,4.$
	\only<1-1> { \begin{figure}[ht]
\centering
\input{omegaj}
%\caption{Solution of the Riemann Problem.}
\label{fig:omegaj}
\end{figure}}
	\item<2-> Define the set $\Omega=\left\lbrace(\gamma_1,\gamma_2)\in \Omega_1\times \Omega_2 \mid A\cdot (\gamma_1 , \gamma_2)^{T}\in \Omega_3\times\Omega_4\right\rbrace .$
	\only<2-3> { \begin{figure}[ht]
\centering
\input{omega}
%\caption{Solution of the Riemann Problem.}
\label{fig:omega}
\end{figure}}
\item<3-> The set $\Omega$ is closed, convex and not empty.
\item<4->\textcolor{red}{Unique solution:}
\begin{figure}[ht]
\centering
\input{solution}
%\caption{Solution of the Riemann Problem.}
\label{fig:solution}
\end{figure}
\end{itemize}
\end{frame}

%\subsection{2x1 Junction model}
\subsubsection{2x1 Junction Solution}
\begin{frame}[fragile]
	\frametitle{2x1 Junction Solution}
	\begin{center}
\textcolor{red}{What happens if we have a 2x1 junction?}
	\end{center}
\pause	
	\begin{figure}[ht]
\centering
\input{2x1junction}
%\caption{Solution of the Riemann Problem.}
\label{fig:2x1junction}
\end{figure}
\pause
\begin{center}
\textbf{The solution is not unique!}
\end{center}
\end{frame}

%\subsubsection{Assumptions}
\begin{frame}[fragile]
	\frametitle{Assumptions}
\begin{itemize}
	\item Introduce a priority parameter $P \in ]0,1[$.
	\vspace*{5mm}
	\item In the outgoing road, $Pf_1(\rho_1(t,b_1+))$ will be the portion of flux coming from the first incoming road, and $(1-P)f_2(\rho_2(t,b_2+))$, the one coming from the second. 
	\vspace*{5mm}	
	\item To maximize the traffic going through, we set $$\hat{\gamma}_3=\min{\left\lbrace\gamma_1^{\max}(\rho_{1,0})+\gamma_2^{\max}(\rho_{2,0}),\gamma_3^{\max}(\rho_{3,0})\right\rbrace} .$$
	
\end{itemize}

\end{frame}

%\subsubsection{Riemann Solver}
\begin{frame}[fragile]
	\frametitle{Riemann Solver}
	\begin{itemize}
	\item<1-> We follow all the steps as in the other case and what we obtain is $\Omega=\left\lbrace (\gamma_1,\gamma_2): 0\leq\gamma_i\leq\gamma_i^{max}(\rho_{i,0}), 0\leq\gamma_1+\gamma_2\leq\hat{\gamma}_3\right\rbrace .$
	\only<1-1>{	\begin{figure}[ht]
\centering
\input{2x1junctionsolution}
%\caption{Solution of the Riemann Problem.}
\label{fig:2x1juncSol}
\end{figure}}
	\item<2-> We draw the line $\gamma_2=\dfrac{P}{1-P}\gamma_1 .$
	\only<2-2>	{\begin{figure}[ht]
\centering
\input{2x1junctionpriority}
%\caption{Solution of the Riemann Problem.}
\label{fig:2x1juncPrior}
\end{figure}}
	\item<3-> Three cases: 
	\vspace*{5mm}
	\only<3-3>{\begin{columns}
	\column{0.33 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{2x1solutionInside}}
%\caption{Solution of the Riemann Problem.}
\label{fig:2x1juncSolIns}}
\end{figure}
	\column{0.33 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{2x1solutionOutside1}}
%\caption{Solution of the Riemann Problem.}
\label{fig:2x1juncSolOut1}}
\end{figure}
	\column{0.33 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{2x1solutionOutside2}}
%\caption{Solution of the Riemann Problem.}
\label{fig:2x1juncSolOut2}}
\end{figure}
\end{columns}
	}
	\end{itemize}

\end{frame}

%\subsubsection{Riemann Solver II}
\begin{frame}[fragile]
	\frametitle{Riemann Solver II}
	\begin{itemize}
	\item<1-> If $Q\in \Omega$ then $Q$ is the solution.
	\only<1-1> {	\begin{figure}[ht]
\centering
\input{2x1solutionInside}
%\caption{Solution of the Riemann Problem.}
\label{fig:Inside}
\end{figure}}
	\item<2-> If $Q \notin\Omega$ we set a point $P$ such that $P\in \Omega \cap \left\lbrace (\gamma_1,\gamma_2):\gamma_1+\gamma_2=\hat{\gamma}_3\right\rbrace $ closest to priority line.
	\only<2-2> {\begin{columns}
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{Ppoint1}}
%\caption{Solution of the Riemann Problem.}
\label{fig:P1}}
\end{figure}
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{Ppoint2}}
%\caption{Solution of the Riemann Problem.}
\label{fig:Ppoint2}}
\end{figure}
\end{columns}
	}
	\end{itemize}
\end{frame}	

%\subsubsection{Riemann Solver III}
\begin{frame}[fragile]
	\frametitle{Riemann Solver III}
The solutions we found are in the flux domain. How to go back to the density domain?
\begin{definition}
Let $\tau:[0,1]\rightarrow[0,1]$ be the map such that:
	\begin{itemize}
		\item $f(\tau(\rho))=f(\rho)$ for every $\rho\in [0,1]$;
		\item $\tau(\rho)\neq\rho$ for every $\rho\in[0,1]\setminus\{\rho^{cr}\}.$
	\end{itemize}
\end{definition}	
The function $\tau(\rho)$ is continuous and well defined. Moreover, it satisfies $$0\leq\rho\leq\rho^{cr}  \Longleftrightarrow \rho^{cr}\leq\tau(\rho)\leq 1 \qquad 0\leq\tau(\rho)\leq\rho^{cr}  \Longleftrightarrow \rho^{cr}\leq\rho\leq 1.$$
\end{frame}

%\subsubsection{Riemann Solver IV}
\begin{frame}[label=Solution,fragile]
	\frametitle{Riemann Solver IV}
Given $\rho_i(0,\cdot), \rho_j(0,\cdot) \; \text{for every}\; i,j$ there exists a $n+m$-tuple $(\hat{\rho}_i ,\hat{\rho}_j)\in[0,1]^{n+m}$ such that
	\begin{equation}
		\hat{\rho}_i\in\left\{
		\begin{array}{ll}
		\{\rho_{i,0}\}\cup]\tau(\rho_{i,0}),1] &\hbox{if}~0 \leq \rho_{i,0}\leq\rho^{cr} ,\\
		\left[\rho^{cr},1\right] &\hbox{if}~\rho^{cr} \leq \rho_{i,0}\leq 1;
		\end{array}
		\right.
		\label{eq:rho_i}
		\hyperlink{drawing}{\beamerbutton{...}}
	\end{equation}
	and
	\begin{equation}
		\hat{\rho}_j\in\left\{
		\begin{array}{ll}
		\left[0,\rho^{cr}\right] &\hbox{if}~0 \leq \rho_{j,0}\leq\rho^{cr} ,\\		
		\{\rho_{j,0}\}\cup[0,\tau(\rho_{j,0})[ &\hbox{if}~\rho^{cr} \leq \rho_{j,0}\leq 1;
		\end{array}
		\right.
		\label{eq:rho_j}
		\hyperlink{drawingO}{\beamerbutton{...}}
	\end{equation}
and for the incoming roads the solutions are given by the waves $(\rho_{i,0},\hat{\rho}_i)$, while for the outgoing road the solutions are given by the waves $(\hat{\rho}_j,\rho_{j,0})$ for every $i,j$.\\

\begin{flushright}
\hyperlink{Theorem}{\beamerbutton{Theorem}}
\end{flushright}
\end{frame}

%\subsubsection{Riemann Solver V}
\begin{frame}[label=drawing, fragile]
	\frametitle{Riemann Solver V}
For the incoming roads
\only<1->{\begin{columns}
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{incoming1}}
%\caption{Solution of the Riemann Problem.}
\label{fig:I1}}
\end{figure}
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{incoming2}}
%\caption{Solution of the Riemann Problem.}
\label{fig:I2}}
\end{figure}
\end{columns}
\begin{flushright}
\hyperlink{Solution}{\beamerbutton{Back}}
\end{flushright}	}
\end{frame}


%\subsubsection{Riemann Solver Vbis}

\begin{frame}[label=drawingO, fragile]
\frametitle{Riemann Solver V}
For the outgoing roads	
\begin{columns}
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{outgoing1}}
%\caption{Solution of the Riemann Problem.}
\label{fig:I1}}
\end{figure}
	\column{0.5 \textwidth}
	\begin{figure}[ht]
\centering
{
\resizebox{.9\columnwidth}{!}{
\input{outgoing2}}
%\caption{Solution of the Riemann Problem.}
\label{fig:O2}}
\end{figure}
\end{columns}
\begin{flushright}
\hyperlink{Solution}{\beamerbutton{Back}}
\end{flushright}	
	
\end{frame}

%\subsubsection{Self-similarity}
\begin{frame}[label=Theorem, fragile]
\frametitle{Self-similarity}
\begin{theorem}
	\label{th:existenceSolPiccoli}
	Consider a junction $J$ and a priority parameter $P\in ]0,1[$ or a distribution matrix $A$. Then there exists a unique Riemann Solver $\RS$ such that for a.e. $t>0$ it holds 
	$$(\rho_i(t,b_i-),\rho_j(t,a_j+))=\RS(\rho_i(t,b_i-),\rho_j(t,a_j+)) \quad \forall i,j .$$ 
\end{theorem}
\end{frame}

\frame{
  \setbeamercovered{transparent}
	\frametitle{Self-similarity and LN-CTM~\cite{Muralidharana}}
  \begin{itemize}
    \item<1-> Self-similarity: guarantees junction solution only generates one shock
    \item<2-> Subsequent solutions of junction should be stationary, assuming Riemann conditions (see Figure~\ref{fig:ss})
  \end{itemize}
  \begin{figure}[ht]
\centering
{
\resizebox{.4\columnwidth}{!}{
\input{lnctmtikz}}
\caption{LN-CTM is not self-similar when considering the limit of the discrete model}
\label{fig:ss}}
\end{figure}
}