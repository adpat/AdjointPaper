% !TEX root = rampMeteringViaTheAdjoint.tex
\def \rampDem{1.7}
\def \dem{1.5}
\def \priorityRat{0.8}
\def \totalFlow{2.5}
\def \twoGap{.3}

\begin{tikzpicture}[scale=\scale,domain=0:1]

\coordinate (Z) at (0,0);
\coordinate (I1) at (\rampDem, 0);
\coordinate (I2) at (0, \dem);
\coordinate (I3) at (\rampDem, \dem);
\coordinate (I4) at (\rampDem+\twoGap, 0);
\coordinate (I5) at (\rampDem+\twoGap, \dem);
\coordinate (A) at (0, {\totalFlow});
\coordinate (B) at (\totalFlow, 0);
\coordinate (C) at ({(1-\priorityRat)/\priorityRat*\dem}, \dem);
\coordinate (Cplus) at ({(1-\priorityRat)/\priorityRat*\totalFlow}, \totalFlow);
\coordinate (P1) at (intersection of I1--I3 and A--B);
\coordinate (P2) at (intersection of I2--I3 and A--B);


\draw[->] (Z) -- (3,0) node[below right]{$\rsind{\virtualind{\fluxsymbol_{\linkmlone}}}$};
\draw[->] (Z) -- (0,3) node[left]{$\rsind{\virtualind{\fluxsymbol_{\linkon}}}$};
\draw[dashed] (I3) -- (I1) node[below]{$\virtualind{\maxflux_{\linkmlone}}$};
\draw[dashed, line width = 2pt] (I5) -- (I4) node[below]{$\virtualind{\rsind{\maxflux}}_{\linkmlone}$};
\draw[dashed, line width = 2pt] (I5) -- (I2) node[left]{$\virtualind{\rsind{\maxflux}}_{\linkon},\virtualind{\maxflux_{\linkon}}$};
\draw (A) -- (B) node[yshift=1cm, xshift=0cm]{$\rsind{\virtualind{\fluxsymbol_{\linkon}}}+\rsind{\virtualind{\fluxsymbol_{\linkmlone}}}=\virtualind{\rsind{\maxflux}}_{\linkmltwo}$};
\draw (Z) -- (C) node[below, xshift=1cm,yshift=-1cm,]{$\rsind{\virtualind{\fluxsymbol_{\linkmlone}}}=\left(\frac{\prioritysymbol}{1-\prioritysymbol}\right)\rsind{\virtualind{\fluxsymbol_{\linkon}}}$};
\draw[dashed,->] (C) -- (Cplus);
\draw (intersection of A--B and Z--C) node [right](xseclabel){$\left(\prioritysymbol\maxflux_{\linkmltwo},\maxflux_{\fluxsymbol}-\prioritysymbol\maxflux_{\linkmltwo}\right)$} circle (1pt);
\draw[color=red, line width = 2pt] (intersection of I5--I2 and A--B) node[above,xshift=1cm] (optimallabel){Optimal} circle (1pt);

\end{tikzpicture}
